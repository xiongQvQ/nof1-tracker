# Nof1 AI Agent è·Ÿå•äº¤æ˜“ç³»ç»Ÿ - ç»¼åˆç­–ç•¥æ–‡æ¡£

## ğŸ“‹ ç›®å½•
- [ç³»ç»Ÿæ¦‚è¿°](#ç³»ç»Ÿæ¦‚è¿°)
- [æ¶æ„è®¾è®¡](#æ¶æ„è®¾è®¡)
- [è·Ÿå•ç­–ç•¥è¯¦è§£](#è·Ÿå•ç­–ç•¥è¯¦è§£)
- [é£é™©ç®¡ç†æœºåˆ¶](#é£é™©ç®¡ç†æœºåˆ¶)
- [èµ„é‡‘ç®¡ç†ç³»ç»Ÿ](#èµ„é‡‘ç®¡ç†ç³»ç»Ÿ)
- [ä»·æ ¼å®¹å¿åº¦æœºåˆ¶](#ä»·æ ¼å®¹å¿åº¦æœºåˆ¶)
- [æ­¢ç›ˆæ­¢æŸè‡ªåŠ¨åŒ–](#æ­¢ç›ˆæ­¢æŸè‡ªåŠ¨åŒ–)
- [é…ç½®ç®¡ç†](#é…ç½®ç®¡ç†)
- [ä½¿ç”¨æŒ‡å—](#ä½¿ç”¨æŒ‡å—)
- [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)

## ğŸ¯ ç³»ç»Ÿæ¦‚è¿°

### ç³»ç»Ÿå®šä½
Nof1 AI Agentè·Ÿå•äº¤æ˜“ç³»ç»Ÿæ˜¯ä¸€ä¸ªä¸“ä¸šçº§çš„é‡åŒ–äº¤æ˜“å·¥å…·ï¼Œé€šè¿‡AIç®—æ³•åˆ†æ7ä¸ªé¡¶çº§AI Agentçš„äº¤æ˜“ç­–ç•¥ï¼Œå®ç°è‡ªåŠ¨åŒ–è·Ÿå•äº¤æ˜“ã€‚

### æ ¸å¿ƒä»·å€¼
- **æ™ºèƒ½è·Ÿå•**: å®æ—¶è·ŸéšAI Agentçš„äº¤æ˜“å†³ç­–
- **é£é™©æ§åˆ¶**: å¤šç»´åº¦é£é™©è¯„ä¼°ä¿æŠ¤ç”¨æˆ·èµ„é‡‘
- **èµ„é‡‘ç®¡ç†**: çµæ´»çš„ä¿è¯é‡‘åˆ†é…å’Œä»“ä½æ§åˆ¶
- **è‡ªåŠ¨åŒ–**: æ­¢ç›ˆæ­¢æŸè®¢å•çš„è‡ªåŠ¨åˆ›å»ºå’Œç®¡ç†

### æŠ€æœ¯ç‰¹è‰²
- **TDDå¼€å‘**: 100%æµ‹è¯•é©±åŠ¨å¼€å‘ï¼Œä»£ç è´¨é‡ä¿è¯
- **æ¨¡å—åŒ–æ¶æ„**: æ¸…æ™°çš„æ¨¡å—åˆ†ç¦»ï¼Œæ˜“äºç»´æŠ¤å’Œæ‰©å±•
- **å®æ—¶ç›‘æ§**: æ”¯æŒæŒç»­è½®è¯¢å’Œå®æ—¶è·Ÿå•
- **çµæ´»é…ç½®**: æ”¯æŒåŠ¨æ€é…ç½®å’Œå¸ç§ç‰¹å®šè®¾ç½®

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### ç³»ç»Ÿæ¶æ„å›¾
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   CLIå…¥å£     â”‚    â”‚   é…ç½®ç®¡ç†å™¨     â”‚    â”‚   é£é™©ç®¡ç†å™¨     â”‚
â”‚   (index.ts)   â”‚â”€â”€â”€â–¶â”‚ (ConfigManager)  â”‚â”€â”€â”€â–¶â”‚ (RiskManager)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ï¿½    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ï¿½    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                     â”‚                     â”‚
         â–¼                     â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  APIåˆ†æå¼•æ“   â”‚â”€â”€â”€â–¶â”‚  èµ„é‡‘ç®¡ç†å™¨     â”‚â”€â”€â”€â–¶â”‚  äº¤æ˜“æ‰§è¡Œå™¨     â”‚
â”‚(analyze-api.ts)â”‚    â”‚(CapitalManager) â”‚    â”‚(TradingExecutor)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ï¿½    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ï¿½    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                     â”‚                     â”‚
         â–¼                     â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Nof1 API     â”‚    â”‚   Binance API    â”‚    â”‚   ç”¨æˆ·äº¤äº’ç•Œé¢   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®æµè®¾è®¡
```
Nof1 API â†’ æ•°æ®è·å– â†’ çŠ¶æ€è¿‡æ»¤ â†’ å˜åŒ–æ£€æµ‹ â†’ ç­–ç•¥ç”Ÿæˆ â†’ é£é™©è¯„ä¼° â†’ èµ„é‡‘åˆ†é… â†’ è®¢å•æ‰§è¡Œ â†’ äº¤æ˜“ç¡®è®¤
    â†“         â†“        â†“        â†“        â†“        â†“        â†“        â†“
åŸå§‹æ•°æ® â†’ æœ€æ–°çŠ¶æ€ â†’ ä»“ä½å˜åŒ– â†’ äº¤æ˜“ä¿¡å· â†’ é£é™©æ£€æŸ¥ â†’ ä¿è¯é‡‘åˆ†é… â†’ ä¸‹å•æˆåŠŸ â†’ ç»“æœåé¦ˆ
```

### æ ¸å¿ƒç»„ä»¶å…³ç³»
```
ConfigManager
â”œâ”€â”€ RiskManager
â”‚   â”œâ”€â”€ FuturesCapitalManager
â”‚   â”‚   â”œâ”€â”€ ApiAnalyzer
â”‚   â”‚   â”‚   â”œâ”€â”€ TradingExecutor
â”‚   â”‚   â”‚   â””â”€â”€ BinanceService
â”‚   â”‚   â””â”€â”€ PriceToleranceCheck
â”‚   â””â”€â”€ CLI Commands
```

## ğŸ“Š è·Ÿå•ç­–ç•¥è¯¦è§£

### è·Ÿå•ç­–ç•¥å±‚æ¬¡ç»“æ„
```
Level 1: å®æ—¶ç›‘æ§
â”œâ”€â”€ å®šæœŸè½®è¯¢ Nof1 API (é»˜è®¤30ç§’)
â”œâ”€â”€ æå– 7ä¸ª AI Agent çš„è´¦æˆ·æ•°æ®
â””â”€â”€ ä½¿ç”¨ getLatestAgentData() è¿‡æ»¤æœ€æ–°çŠ¶æ€

Level 2: å˜åŒ–æ£€æµ‹
â”œâ”€â”€ ENTRY_OID å˜åŒ–æ£€æµ‹ (æ–°å…¥åœºä¿¡å·)
â”œâ”€â”€ Quantity å˜åŒ–æ£€æµ‹ (å¹³ä»“ä¿¡å·)
â”œâ”€â”€ ä»“ä½çŠ¶æ€å˜åŒ– (å¼€ä»“/å¹³ä»“)
â””â”€â”€ æ­¢ç›ˆæ­¢æŸè§¦å‘ (è‡ªåŠ¨é€€å‡º)

Level 3: ç­–ç•¥å†³ç­–
â”œâ”€â”€ æ–°ä»“ä½ â†’ ENTER ç­–ç•¥
â”œâ”€â”€ OIDå˜åŒ– â†’ EXIT+ENTER ç­–ç•¥
â”œâ”€â”€ å¹³ä»“ä¿¡å· â†’ EXIT ç­–ç•¥
â””â”€â”€ æ­¢ç›ˆæ­¢æŸ â†’ EXIT ç­–ç•¥

Level 4: æ‰§è¡Œæ§åˆ¶
â”œâ”€â”€ é£é™©è¯„ä¼°æ£€æŸ¥
â”œâ”€â”€ ä»·æ ¼å®¹å¿åº¦éªŒè¯
â”œâ”€â”€ èµ„é‡‘åˆ†é…è®¡ç®—
â””â”€â”€ è®¢å•æ‰§è¡Œç¡®è®¤
```

### è¯¦ç»†è·Ÿå•è§„åˆ™

#### 1. æ–°ä»“ä½æ£€æµ‹ç­–ç•¥
```typescript
// è§¦å‘æ¡ä»¶
- quantity !== 0 (æœ‰ä»“ä½)
- current_price > 0 (ä»·æ ¼æœ‰æ•ˆ)
- leverage > 0 (æ æ†æœ‰æ•ˆ)
- ä¹‹å‰è¯¥å¸ç§æ— ä»“ä½

// æ‰§è¡ŒåŠ¨ä½œ
ç”Ÿæˆ ENTER è®¡åˆ’ï¼š
- side: quantity > 0 ? "BUY" : "SELL"
- type: "MARKET"
- quantity: Math.abs(quantity)
- leverage: position.leverage
- entryPrice: position.entry_price
```

#### 2. OIDå˜åŒ–æ£€æµ‹ç­–ç•¥ (æ ¸å¿ƒåˆ›æ–°)
```typescript
// è§¦å‘æ¡ä»¶
- prevPosition.quantity !== 0 && position.quantity !== 0
- prevPosition.entry_oid !== position.entry_oid
- position.quantity !== 0 (æ–°è®¢å•)

// æ‰§è¡ŒåŠ¨ä½œ (ä¸¤æ­¥æ“ä½œ)
Step 1: EXIT æ—§ä»“ä½
- side: prevPosition.quantity > 0 ? "SELL" : "BUY"
- quantity: Math.abs(prevPosition.quantity)
- reason: "Entry order changed (old: old_oid â†’ new: new_oid) - closing old position"

Step 2: ENTER æ–°ä»“ä½
- side: position.quantity > 0 ? "BUY" : "SELL"
- quantity: Math.abs(position.quantity)
- reason: "New entry order (new_oid) by agent"
```

#### 3. å¹³ä»“æ£€æµ‹ç­–ç•¥
```typescript
// è§¦å‘æ¡ä»¶
- prevPosition.quantity !== 0
- position.quantity === 0

// æ‰§è¡ŒåŠ¨ä½œ
ç”Ÿæˆ EXIT è®¡åˆ’ï¼š
- side: prevPosition.quantity > 0 ? "SELL" : "BUY"
- quantity: Math.abs(prevPosition.quantity)
- reason: "Position closed by agent"
```

#### 4. æ­¢ç›ˆæ­¢æŸæ£€æµ‹ç­–ç•¥
```typescript
// å¤šå¤´ä»“ä½æ­¢ç›ˆæ¡ä»¶
if (current_price >= position.exit_plan.profit_target) {
  ç”Ÿæˆ EXIT è®¡åˆ’ï¼š`Take profit at ${profit_target}`
}

// å¤šå¤´ä»“ä½æ­¢æŸæ¡ä»¶
if (current_price <= position.exit_plan.stop_loss) {
  ç”Ÿæˆ EXIT è®¡åˆ’ï¼š`Stop loss at ${stop_loss}`
}

// ç©ºå¤´ä»“ä½ç›¸åé€»è¾‘
if (position.quantity < 0) {
  // æ­¢ç›ˆæ¡ä»¶ï¼šcurrent_price <= profit_target
  // æ­¢æŸæ¡ä»¶ï¼šcurrent_price >= stop_loss
}
```

### çŠ¶æ€ç®¡ç†æœºåˆ¶
```typescript
// å†å²æŒä»“çŠ¶æ€è·Ÿè¸ª
private lastPositions: Map<string, Position[]> = new Map<string, Position[]>();

// çŠ¶æ€æ›´æ–°æµç¨‹
1. è·å–å½“å‰ Agent æ‰€æœ‰ä»“ä½
2. ä¸å†å²æŒä»“å¯¹æ¯”æ£€æµ‹å˜åŒ–
3. ç”Ÿæˆç›¸åº”çš„ FollowPlan
4. æ›´æ–° lastPositions çŠ¶æ€
5. é‡å¤è½®è¯¢å¾ªç¯
```

## âš ï¸ é£é™©ç®¡ç†æœºåˆ¶

### é£é™©è¯„ä¼°ä½“ç³»
```
é£é™©è¯„ä¼°çŸ©é˜µ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   é£é™©ç»´åº¦     â”‚   è¯„åˆ†æƒé‡     â”‚   é£é™©ç­‰çº§     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   æ æ†å€æ•°     â”‚    æ æ† Ã— 10   â”‚    1-100åˆ†     â”‚
â”‚   äº¤æ˜“è§„æ¨¡     â”‚    æ•°é‡ Ã— 5     â”‚    0-50åˆ†      â”‚
â”‚   å¸‚åœºæ³¢åŠ¨     â”‚   åŠ¨æ€è¯„ä¼°     â”‚    0-50åˆ†      â”‚
â”‚   ä»·æ ¼åç¦»     â”‚   åç¦»åº¦ Ã— 20   â”‚    0-100åˆ†     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é£é™©ç­‰çº§åˆ’åˆ†ï¼š
- 0-30åˆ†: ä½é£é™© âœ…
- 31-70åˆ†: ä¸­ç­‰é£é™© âš ï¸
- 71-90åˆ†: é«˜é£é™© ğŸš¨
- 91-100åˆ†: æé«˜é£é™© âŒ
```

### é£é™©æ§åˆ¶æœºåˆ¶
```typescript
interface RiskAssessment {
  isValid: boolean;           // æ˜¯å¦å…è®¸æ‰§è¡Œ
  riskScore: number;           // ç»¼åˆé£é™©è¯„åˆ† (0-100)
  warnings: string[];           // é£é™©è­¦å‘Šåˆ—è¡¨
  maxLoss: number;             // æœ€å¤§æŸå¤±é¢„ä¼°
  suggestedPositionSize: number; // å»ºè®®ä»“ä½å¤§å°
  priceTolerance?: PriceToleranceCheck; // ä»·æ ¼å®¹å¿åº¦æ£€æŸ¥
}
```

### å¤šå±‚é£é™©æ£€æŸ¥
```typescript
// ç¬¬ä¸€å±‚ï¼šåŸºç¡€é£é™©è¯„ä¼°
if (riskScore > 100) {
  return { isValid: false, error: "Risk score exceeds maximum limit" };
}

// ç¬¬äºŒå±‚ï¼šä»·æ ¼å®¹å¿åº¦æ£€æŸ¥
if (priceTolerance && !priceTolerance.withinTolerance) {
  return { isValid: false, error: "Price difference exceeds tolerance" };
}

// ç¬¬ä¸‰å±‚ï¼šæ æ†é™åˆ¶æ£€æŸ¥
if (leverage > 50) {
  return { isValid: false, error: "Leverage too high" };
}

// ç¬¬å››å±‚ï¼šèµ„é‡‘å……è¶³æ€§æ£€æŸ¥
if (allocatedMargin > availableMargin) {
  return { isValid: false, error: "Insufficient margin" };
}
```

### é£é™©é¢„è­¦ç³»ç»Ÿ
```typescript
// å®æ—¶é£é™©ç›‘æ§
const riskMonitoring = {
  leverage: {
    threshold: 20,
    warning: "Leverage > 20x detected",
    action: "Consider reducing position size"
  },
  concentration: {
    threshold: 0.8,
    warning: "High concentration in single position",
    action: "Consider diversifying"
  },
  volatility: {
    threshold: 5,
    warning: "High market volatility detected",
    action: "Reduce position size or increase tolerance"
  }
};
```

## ğŸ’° èµ„é‡‘ç®¡ç†ç³»ç»Ÿ

### èµ„é‡‘åˆ†é…åŸåˆ™
```
åˆ†é…ä¼˜å…ˆçº§ï¼š
1. æ¯”ä¾‹ä¿æŒï¼šä¸¥æ ¼æŒ‰ç…§ Agent åŸå§‹ä¿è¯é‡‘æ¯”ä¾‹
2. æ æ†ä¿æŒï¼šå®Œå…¨å¤åˆ¶ Agent çš„æ æ†è®¾ç½®
3. æ–¹å‘ä¿æŒï¼šä¿æŒ Agent çš„ BUY/SELL æ–¹å‘
4. ç²¾ç¡®è®¡ç®—ï¼šæ ¹æ®åˆ†é…èµ„é‡‘å’Œå½“å‰ä»·æ ¼è®¡ç®—æ•°é‡
```

### èµ„é‡‘åˆ†é…ç®—æ³•
```typescript
// æ ¸å¿ƒåˆ†é…å…¬å¼
function allocateMargin(positions: Position[], totalMargin: number): CapitalAllocationResult {
  // Step 1: è®¡ç®—æ€»åŸå§‹ä¿è¯é‡‘
  const totalOriginalMargin = positions.reduce((sum, p) => sum + p.margin, 0);

  // Step 2: è®¡ç®—åˆ†é…æ¯”ä¾‹
  const allocationRatio = position.margin / totalOriginalMargin;

  // Step 3: åˆ†é…ç”¨æˆ·ä¿è¯é‡‘
  const allocatedMargin = totalMargin * allocationRatio;

  // Step 4: è®¡ç®—åä¹‰æŒä»“ä»·å€¼
  const notionalValue = allocatedMargin * position.leverage;

  // Step 5: è®¡ç®—è°ƒæ•´åæ•°é‡
  const adjustedQuantity = notionalValue / position.current_price;

  return {
    symbol: position.symbol,
    originalMargin: position.margin,
    allocatedMargin,
    notionalValue,
    adjustedQuantity,
    allocationRatio,
    leverage: position.leverage,
    side: position.quantity > 0 ? "BUY" : "SELL"
  };
}
```

### èµ„é‡‘ç®¡ç†é…ç½®
```typescript
interface CapitalConfig {
  defaultTotalMargin: number;     // é»˜è®¤æ€»ä¿è¯é‡‘ (1000 USDT)
  maxLeverage: number;           // æœ€å¤§æ æ†å€æ•° (50x)
  minPositionSize: number;       // æœ€å°ä»“ä½å¤§å° (0.001)
  maxPositionRatio: number;      // å•ä»“ä½æœ€å¤§å æ¯” (30%)
}
```

### å®é™…åˆ†é…ç¤ºä¾‹
```bash
# ç¤ºä¾‹ï¼šGPT-5 Agent 6ä¸ªä»“ä½åˆ†é…
# æ€»ä¿è¯é‡‘ï¼š1000 USDT

ğŸ’° Capital Allocation for gpt-5:
==========================================
ğŸ’° Total Margin: $1000.00
ğŸ“ˆ Total Notional Value: $17527.00

BTCUSDT - BUY (20x leverage)
   ğŸ“Š Original Margin: $248.66 (20.07%)
   ğŸ’° Allocated Margin: $200.70
   ğŸ“ˆ Notional Value: $4014.00
   ğŸ“ Adjusted Quantity: 0.0366 BTC

ETHUSDT - BUY (20x leverage)
   ğŸ“Š Original Margin: $205.80 (16.61%)
   ğŸ’° Allocated Margin: $166.10
   ğŸ“ˆ Notional Value: $3322.00
   ğŸ“ Adjusted Quantity: 0.854 ETH

XRPUSDT - SELL (20x leverage)
   ğŸ“Š Original Margin: $201.16 (16.23%)
   ğŸ’° Allocated Margin: $162.30
   ğŸ“ˆ Notional Value: $3246.00
   ğŸ“ Adjusted Quantity: 1353 XRP

DOGEUSDT - BUY (10x leverage)
   ğŸ“Š Original Margin: $183.97 (14.85%)
   ğŸ’° Allocated Margin: $148.50
   ğŸ“ˆ Notional Value: $1485.00
   ğŸ“ Adjusted Quantity: 7873 DOGE

SOLUSDT - BUY (20x leverage)
   ğŸ“Š Original Margin: $177.83 (14.35%)
   ğŸ’° Allocated Margin: $143.50
   ğŸ“ˆ Notional Value: $2870.00
   ğŸ“ Adjusted Quantity: 15.26 SOL

BNBUSDT - SELL (10x leverage)
   ğŸ“Š Original Margin: $221.87 (17.90%)
   ğŸ’° Allocated Margin: $179.00
   ğŸ“ˆ Notional Value: $1790.00
   ğŸ“ Adjusted Quantity: 1.62 BNB
```

## ğŸ“ ä»·æ ¼å®¹å¿åº¦æœºåˆ¶

### ä»·æ ¼å®¹å¿åº¦è®¾è®¡ç†å¿µ
```
æ ¸å¿ƒç›®æ ‡ï¼šé˜²æ­¢åœ¨ä»·æ ¼åå·®è¿‡å¤§æ—¶æ‰§è¡Œä¸åˆ©äº¤æ˜“
åŸºæœ¬åŸåˆ™ï¼šå·®å¼‚ â‰¤ é˜ˆå€¼ â†’ æ‰§è¡Œï¼Œå·®å¼‚ > é˜ˆå€¼ â†’ æ”¾å¼ƒ
```

### ä»·æ ¼å·®å¼‚è®¡ç®—
```typescript
function calculatePriceDifference(entryPrice: number, currentPrice: number): number {
  return Math.abs((currentPrice - entryPrice) / entryPrice) * 100;
}

// ç¤ºä¾‹è®¡ç®—
entryPrice: 43000, currentPrice: 43500
priceDifference = Math.abs((43500 - 43000) / 43000) * 100 = 1.16%
```

### å®¹å¿åº¦æ£€æŸ¥é€»è¾‘
```typescript
interface PriceToleranceCheck {
  entryPrice: number;
  currentPrice: number;
  priceDifference: number;     // ä»·æ ¼å·®å¼‚ç™¾åˆ†æ¯”
  tolerance: number;            // å®¹å¿åº¦é˜ˆå€¼
  withinTolerance: boolean;      // æ˜¯å¦åœ¨å®¹å¿èŒƒå›´å†…
  shouldExecute: boolean;       // æ˜¯å¦åº”è¯¥æ‰§è¡Œ
  reason: string;              // å†³ç­–åŸå› 
}
```

### å®¹å¿åº¦é…ç½®ç­–ç•¥
```typescript
// ä¸åŒå¸‚åœºçŠ¶å†µçš„å®¹å¿åº¦å»ºè®®
const toleranceStrategies = {
  stable: {
    range: "0.2% - 0.5%",
    description: "ä»·æ ¼å˜åŒ–å°çš„ç¨³å®šå¸‚åœº"
  },
  volatile: {
    range: "0.5% - 1.0%",
    description: "æ­£å¸¸æ³¢åŠ¨çš„å¸‚åœº"
  },
  highVolatility: {
    range: "1.0% - 2.0%",
    description: "å‰§çƒˆæ³¢åŠ¨çš„å¸‚åœº"
  },
  newsEvent: {
    range: "1.5% - 3.0%",
    description: "é‡å¤§æ–°é—»äº‹ä»¶æœŸé—´"
  }
};
```

### å®¹å¿åº¦åº”ç”¨ç¤ºä¾‹
```bash
# ç¤ºä¾‹1ï¼šåœ¨å®¹å¿èŒƒå›´å†…
Entry: $43000, Current: $43215
Price Difference: 0.50% (Tolerance: 0.5%)
âœ… Price Tolerance: Price difference 0.50% is within tolerance 0.50%
âœ… Risk assessment: PASSED

# ç¤ºä¾‹2ï¼šè¶…å‡ºå®¹å¿èŒƒå›´
Entry: $43000, Current: $43500
Price Difference: 1.16% (Tolerance: 0.5%)
âŒ Price Tolerance: Price difference 1.16% exceeds tolerance 0.50%
âŒ Risk assessment: FAILED - Trade skipped
```

## ğŸ¯ æ­¢ç›ˆæ­¢æŸè‡ªåŠ¨åŒ–

### æ­¢ç›ˆæ­¢æŸè®¾è®¡åŸç†
```
è®¾è®¡ç›®æ ‡ï¼šåŸºäº Agent çš„ exit_plan è‡ªåŠ¨åˆ›å»ºæ­¢ç›ˆæ­¢æŸè®¢å•
æ•°æ®æ¥æºï¼šAgent æä¾›çš„ profit_target å’Œ stop_loss å­—æ®µ
æ‰§è¡Œæ—¶æœºï¼šåœ¨ ENTER æ“ä½œæˆåŠŸåç«‹å³åˆ›å»º
```

### è®¢å•ç±»å‹è®¾è®¡
```typescript
// æ­¢ç›ˆè®¢å•
interface TakeProfitOrder {
  symbol: string;
  side: "BUY" | "SELL";
  type: "TAKE_PROFIT_MARKET";
  quantity: string;
  stopPrice: string;
  closePosition?: string;
}

// æ­¢æŸè®¢å•
interface StopLossOrder {
  symbol: string;
  side: "BUY" | "SELL";
  type: "STOP_MARKET";
  quantity: string;
  stopPrice: string;
  closePosition?: string;
}
```

### è®¢å•åˆ›å»ºé€»è¾‘
```typescript
function createStopOrdersFromPosition(
  position: Position,
  positionSide: "BUY" | "SELL"
): StopOrderResult {
  // è®¡ç®—è®¢å•æ–¹å‘ï¼ˆå¤šå¤´å¹³ä»“ç”¨SELLï¼Œç©ºå¤´å¹³ä»“ç”¨BUYï¼‰
  const orderSide = positionSide === "BUY" ? "SELL" : "BUY";

  const orders = {
    takeProfitOrder: null,
    stopLossOrder: null
  };

  // åˆ›å»ºæ­¢ç›ˆè®¢å•
  if (position.exit_plan.profit_target > 0) {
    orders.takeProfitOrder = {
      symbol: position.symbol,
      side: orderSide,
      type: "TAKE_PROFIT_MARKET",
      quantity: Math.abs(position.quantity).toString(),
      stopPrice: position.exit_plan.profit_target.toString()
    };
  }

  // åˆ›å»ºæ­¢æŸè®¢å•
  if (position.exit_plan.stop_loss > 0) {
    orders.stopLossOrder = {
      symbol: position.symbol,
      side: orderSide,
      type: "STOP_MARKET",
      quantity: Math.abs(position.quantity).toString(),
      stopPrice: position.exit_plan.stop_loss.toString()
    };
  }

  return orders;
}
```

### æ­¢ç›ˆæ­¢æŸæ‰§è¡Œç­–ç•¥
```typescript
// åœ¨ executePlanWithStopOrders æ–¹æ³•ä¸­å®ç°
async executePlanWithStopOrders(
  tradingPlan: TradingPlan,
  position: any
): Promise<StopOrderExecutionResult> {
  // Step 1: æ‰§è¡Œä¸»è®¢å•
  const mainOrderResult = await this.executePlan(tradingPlan);
  if (!mainOrderResult.success) {
    return mainOrderResult;
  }

  // Step 2: åˆ›å»ºæ­¢ç›ˆæ­¢æŸè®¢å•
  const stopOrders = this.binanceService.createStopOrdersFromPosition(
    position,
    tradingPlan.side
  );

  // Step 3: æ¨¡æ‹Ÿæ‰§è¡Œæ­¢ç›ˆè®¢å•
  let takeProfitOrderId: string | undefined;
  let stopLossOrderId: string | undefined;

  if (stopOrders.takeProfitOrder) {
    console.log(`ğŸ“ˆ Take Profit: ${stopOrders.takeProfitOrder.stopPrice}`);
    takeProfitOrderId = `tp-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
  }

  if (stopOrders.stopLossOrder) {
    console.log(`ğŸ“‰ Stop Loss: ${stopOrders.stopLossOrder.stopPrice}`);
    stopLossOrderId = `sl-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
  }

  return {
    success: true,
    orderId: mainOrderResult.orderId,
    takeProfitOrderId,
    stopLossOrderId,
    takeProfitOrder: stopOrders.takeProfitOrder || undefined,
    stopLossOrder: stopOrders.stopLossOrder || undefined
  };
}
```

## âš™ï¸ é…ç½®ç®¡ç†

### é…ç½®ç®¡ç†æ¶æ„
```
é…ç½®å±‚æ¬¡ç»“æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç¯å¢ƒå˜é‡é…ç½®   â”‚
â”‚   (.envæ–‡ä»¶)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ï¿½
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   é»˜è®¤é…ç½®       â”‚
â”‚   (ConfigManager)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å…¨å±€ä»·æ ¼å®¹å¿åº¦   â”‚   â”‚ å¸ç§ç‰¹å®šå®¹å¿åº¦ â”‚   â”‚   åŠ¨æ€CLIå‚æ•°  â”‚
â”‚ 0.5% (é»˜è®¤)     â”‚   â”‚ BTC: 1.0%      â”‚   â”‚   --total-margin  â”‚
â”‚                 â”‚   â”‚ ETH: 0.3%      â”‚   â”‚   --price-tolerance â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ï¿½   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ï¿½   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### é…ç½®åŠ è½½ä¼˜å…ˆçº§
```typescript
// é…ç½®ä¼˜å…ˆçº§ï¼ˆä»é«˜åˆ°ä½ï¼‰
1. CLI å‘½ä»¤è¡Œå‚æ•°
2. ç¯å¢ƒå˜é‡ (.env)
3. é»˜è®¤é…ç½®å€¼
4. ä»£ç ç¡¬ç¼–ç å€¼

// åŠ è½½ç¤ºä¾‹
function loadConfiguration() {
  // 1. åŠ è½½ç¯å¢ƒå˜é‡
  configManager.loadFromEnvironment();

  // 2. åº”ç”¨CLIå‚æ•°
  if (cliOptions.priceTolerance) {
    configManager.setPriceTolerance(cliOptions.priceTolerance);
  }

  if (cliOptions.totalMargin) {
    capitalManager.setDefaultTotalMargin(cliOptions.totalMargin);
  }

  // 3. ä½¿ç”¨é»˜è®¤å€¼
  // (å·²åœ¨æ„é€ å‡½æ•°ä¸­è®¾ç½®)
}
```

### ç¯å¢ƒå˜é‡é…ç½®
```env
# ä»·æ ¼å®¹å¿åº¦é…ç½®
PRICE_TOLERANCE=0.5
BTCUSDT_TOLERANCE=1.0
ETHUSDT_TOLERANCE=0.3
ADAUSDT_TOLERANCE=0.8

# Binance APIé…ç½®
BINANCE_API_KEY=your_api_key_here
BINANCE_API_SECRET=your_api_secret_here
BINANCE_TESTNET=true

# èµ„é‡‘ç®¡ç†é…ç½®
TOTAL_MARGIN=1000
MAX_LEVERAGE=50
```

### è¿è¡Œæ—¶é…ç½®
```bash
# åŸºç¡€è·Ÿå•
npm start -- follow gpt-5

# è‡ªå®šä¹‰ä»·æ ¼å®¹å¿åº¦
npm start -- follow gpt-5 --price-tolerance 0.8

# è®¾ç½®æ€»ä¿è¯é‡‘
npm start -- follow gpt-5 --total-margin 2000

# ç»„åˆé…ç½®
npm start -- follow gpt-5 --price-tolerance 1.0 --total-margin 1500 --risk-only
```

### é…ç½®éªŒè¯æœºåˆ¶
```typescript
// é…ç½®éªŒè¯å‡½æ•°
function validateConfiguration(config: TradingConfig): boolean {
  // éªŒè¯ä»·æ ¼å®¹å¿åº¦
  if (config.defaultPriceTolerance <= 0) {
    throw new Error("Price tolerance must be positive");
  }

  if (config.defaultPriceTolerance > 10) {
    throw new Error("Price tolerance cannot exceed 10%");
  }

  // éªŒè¯å¸ç§ç‰¹å®šå®¹å¿åº¦
  Object.values(config.symbolTolerances).forEach(tolerance => {
    if (tolerance <= 0 || tolerance > 10) {
      throw new Error("Symbol tolerance must be between 0 and 10");
    }
  });

  return true;
}
```

## ğŸ“š ä½¿ç”¨æŒ‡å—

### åŸºç¡€æ“ä½œæµç¨‹
```
Step 1: ç¯å¢ƒå‡†å¤‡
â”œâ”€â”€ å®‰è£…ä¾èµ–ï¼šnpm install
â”œâ”€â”€ é…ç½®ç¯å¢ƒå˜é‡
â”œâ”€â”€ è®¾ç½® Binance API å¯†é’¥

Step 2: æŸ¥çœ‹å¯ç”¨Agent
â”œâ”€â”€ åˆ—å‡ºæ‰€æœ‰AI Agent
â”œâ”€â”€ é€‰æ‹©åˆé€‚çš„è·Ÿå•ç›®æ ‡

Step 3: é£é™©æµ‹è¯•
â”œâ”€â”€ ä½¿ç”¨ --risk-only å‚æ•°
â”œâ”€â”€ è®¾ç½®å°é‡‘é¢ä¿è¯é‡‘
â”œâ”€â”€ è§‚å¯Ÿè·Ÿå•è®¡åˆ’

Step 4: å®é™…è·Ÿå•
â”œâ”€â”€ è®¾ç½®åˆé€‚ä¿è¯é‡‘
â”œâ”€â”€ é…ç½®ä»·æ ¼å®¹å¿åº¦
â”œâ”€â”€ å¯åŠ¨æŒç»­ç›‘æ§

Step 5: ç›‘æ§ç®¡ç†
â”œâ”€â”€ å®šæœŸæ£€æŸ¥äº¤æ˜“ç»“æœ
â”œâ”€â”€ è°ƒæ•´é…ç½®å‚æ•°
â””â”€â”€ æå–ç›ˆåˆ©æˆ–æ­¢æŸ
```

### å‘½ä»¤è¡Œä½¿ç”¨æŒ‡å—
```bash
# æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯
npm start -- help

# åˆ—å‡ºå¯ç”¨Agent
npm start -- agents

# è·Ÿå•ç‰¹å®šAgent
npm start -- follow <agent-name>

# ä»…é£é™©è¯„ä¼°
npm start -- follow <agent-name> --risk-only

# è®¾ç½®æ€»ä¿è¯é‡‘
npm start -- follow <agent-name> --total-margin 1000

# è®¾ç½®ä»·æ ¼å®¹å¿åº¦
npm start -- follow <agent-name> --price-tolerance 0.8

# è®¾ç½®ç›‘æ§é—´éš”
npm start -- follow <agent-name> --interval 60

# ç»„åˆä½¿ç”¨
npm start -- follow gpt-5 --total-margin 2000 --price-tolerance 1.0 --interval 30
```

### é…ç½®ç¤ºä¾‹
```bash
# æ–°æ‰‹æ¨èé…ç½®
npm start -- follow claude-sonnet-4-5 --total-margin 100 --risk-only --interval 300

# æ ‡å‡†æŠ•èµ„é…ç½®
npm start -- follow gpt-5 --total-margin 1000 --price-tolerance 0.5 --interval 60

# é«˜é¢‘ç›‘æ§é…ç½®
npm start -- follow deepseek-chat-v3.1 --total-margin 500 --price-tolerance 1.0 --interval 30

# å¤§é¢æŠ•èµ„é…ç½®
npm start -- follow gpt-5 --total-margin 5000 --price-tolerance 0.3 --interval 60
```

## ğŸ’¡ æœ€ä½³å®è·µ

### å®‰å…¨åŸåˆ™
```
1. èµ„é‡‘å®‰å…¨
   âœ… ä»å°é‡‘é¢å¼€å§‹æµ‹è¯•
   âœ… ä½¿ç”¨æµ‹è¯•ç½‘ç¯å¢ƒ
   âœ… ä¸è¦æŠ•å…¥æ— æ³•æ‰¿å—æŸå¤±çš„èµ„é‡‘
   âœ… å®šæœŸæå–ç›ˆåˆ©

2. é£é™©æ§åˆ¶
   âœ… è®¾ç½®åˆç†çš„ä»·æ ¼å®¹å¿åº¦
   âœ… åˆ†æ•£æŠ•èµ„å¤šä¸ªAgent
   âœ… ç›‘æ§é£é™©è¯„åˆ†å˜åŒ–
   âœ… è®¾ç½®æ­¢æŸä¿æŠ¤

3. ç­–ç•¥ä¼˜åŒ–
   âœ… æ ¹æ®å¸‚åœºè°ƒæ•´å‚æ•°
   âœ… å®šæœŸè¯„ä¼°è·Ÿå•æ•ˆæœ
   âœ… é€‚æ—¶è°ƒæ•´Agenté€‰æ‹©
   âœ… ä¿æŒè®°å½•å’Œæ€»ç»“
```

### é…ç½®å»ºè®®
```
# æ–°æ‰‹é˜¶æ®µ (æµ‹è¯•å­¦ä¹ )
æ€»ä¿è¯é‡‘: 50-200 USDT
ä»·æ ¼å®¹å¿åº¦: 0.3-0.5%
è½®è¯¢é—´éš”: 300-600ç§’
Agenté€‰æ‹©: ä¿å®ˆå‹ (claude-sonnet-4-5, buynhold_btc)

# æ ‡å‡†é˜¶æ®µ (æ—¥å¸¸æŠ•èµ„)
æ€»ä¿è¯é‡‘: 500-2000 USDT
ä»·æ ¼å®¹å¿åº¦: 0.5-1.0%
è½®è¯¢é—´éš”: 60-120ç§’
Agenté€‰æ‹©: å¹³è¡¡å‹ (gpt-5, deepseek-chat-v3.1)

# é«˜çº§é˜¶æ®µ (ä¸“ä¸šæŠ•èµ„)
æ€»ä¿è¯é‡‘: 2000-10000 USDT
ä»·æ ¼å®¹å¿åº¦: 0.2-0.8%
è½®è¯¢é—´éš”: 30-60ç§’
Agentç»„åˆ: åˆ†æ•£æŠ•èµ„å¤šä¸ªAgent
```

### ç›‘æ§æŒ‡æ ‡
```
1. èµ„é‡‘æŒ‡æ ‡
   - ä¿è¯é‡‘ä½¿ç”¨ç‡
   - åˆ†é…å‡†ç¡®ç‡
   - æ”¶ç›Šå›æ’¤ç‡

2. é£é™©æŒ‡æ ‡
   - é£é™©è¯„åˆ†åˆ†å¸ƒ
   - ä»·æ ¼åå·®é¢‘ç‡
   - æ æ†ä½¿ç”¨æƒ…å†µ

3. æ€§èƒ½æŒ‡æ ‡
   - APIå“åº”æ—¶é—´
   - è®¢å•æ‰§è¡Œå»¶è¿Ÿ
   - ç³»ç»Ÿç¨³å®šæ€§
```

### æ•…éšœå¤„ç†
```
å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆï¼š

1. APIè¿æ¥å¤±è´¥
   â†’ æ£€æŸ¥ç½‘ç»œè¿æ¥
   â†’ éªŒè¯APIç«¯ç‚¹å¯è®¿é—®æ€§
   â†’ å¢åŠ é‡è¯•æœºåˆ¶

2. èµ„é‡‘åˆ†é…å¤±è´¥
   â†’ æ£€æŸ¥Agentæ•°æ®å®Œæ•´æ€§
   â†’ éªŒè¯marginå­—æ®µå­˜åœ¨
   â†’ ç¡®è®¤æ€»é‡‘é¢è®¾ç½®åˆç†

3. ä»·æ ¼å®¹å¿åº¦è¿‡é«˜/è¿‡ä½
   â†’ åˆ†æå¸‚åœºæ³¢åŠ¨æƒ…å†µ
   - ç¨³å®šå¸‚åœº: 0.2-0.5%
   - æ³¢åŠ¨å¸‚åœº: 0.5-1.0%
   - é«˜æ³¢åŠ¨æœŸ: 1.0-2.0%

4. è®¢å•æ‰§è¡Œå¤±è´¥
   â†’ æ£€æŸ¥Binance APIé…ç½®
   - éªŒè¯APIå¯†é’¥æœ‰æ•ˆæ€§
   - ç¡®è®¤è´¦æˆ·ä½™é¢å……è¶³
```

### æŒç»­æ”¹è¿›
```
1. ç­–ç•¥ä¼˜åŒ–
   - å®šæœŸå›é¡¾è·Ÿå•è¡¨ç°
   - è°ƒæ•´é£é™©å‚æ•°
   - ä¼˜åŒ–Agenté€‰æ‹©

2. ç³»ç»Ÿç»´æŠ¤
   - å®šæœŸæ›´æ–°ä¾èµ–
   - ç›‘æ§ç³»ç»Ÿæ—¥å¿—
   - å¤‡ä»½é‡è¦é…ç½®

3. çŸ¥è¯†æ›´æ–°
   - å…³æ³¨å¸‚åœºå˜åŒ–
   - å­¦ä¹ æ–°çš„äº¤æ˜“ç­–ç•¥
   - æå‡é£é™©æ„è¯†
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æ›´æ–°æ—¶é—´**: 2025-01-24
**ç›¸å…³æ–‡æ¡£**:
- [quick-reference.md](./quick-reference.md)
- [price-tolerance.md](./price-tolerance.md)
- [futures-capital-management.md](./futures-capital-management.md)