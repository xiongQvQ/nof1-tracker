# æµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š

æœ¬é¡¹ç›®å·²é…ç½®å®Œæ•´çš„æµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Šç³»ç»Ÿï¼Œå¸®åŠ©å¼€å‘è€…äº†è§£ä»£ç æµ‹è¯•è¦†ç›–æƒ…å†µã€‚

## ğŸ“Š å¯ç”¨çš„æµ‹è¯•å‘½ä»¤

### åŸºç¡€æµ‹è¯•å‘½ä»¤
```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
npm test

# è¿è¡Œæµ‹è¯•ï¼ˆç›‘è§†æ¨¡å¼ï¼‰
npm run test:watch

# è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
npm run test:coverage
```

### è¦†ç›–ç‡æŠ¥å‘Šå‘½ä»¤
```bash
# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Šï¼ˆæ§åˆ¶å° + HTML + LCOVæ ¼å¼ï¼‰
npm run test:coverage

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Šå¹¶è¾“å‡ºä¸ºLCOVæ ¼å¼ï¼ˆç”¨äºCI/CDé›†æˆï¼‰
npm run test:coverage:report
```

## ğŸ“ˆ è¦†ç›–ç‡æŠ¥å‘Šæ ¼å¼

è¿è¡Œ `npm run test:coverage` åï¼Œä¼šç”Ÿæˆä»¥ä¸‹æ ¼å¼çš„æŠ¥å‘Šï¼š

1. **æ§åˆ¶å°è¾“å‡º**ï¼šç›´æ¥åœ¨ç»ˆç«¯æ˜¾ç¤ºè¦†ç›–ç‡æ‘˜è¦
2. **HTMLæŠ¥å‘Š**ï¼šåœ¨ `coverage/index.html` æŸ¥çœ‹è¯¦ç»†çš„å¯è§†åŒ–æŠ¥å‘Š
3. **LCOVæŠ¥å‘Š**ï¼šåœ¨ `coverage/lcov.info` ç”Ÿæˆç”¨äºCI/CDé›†æˆçš„æŠ¥å‘Š
4. **JSONæŠ¥å‘Š**ï¼šåœ¨ `coverage/coverage-final.json` ç”Ÿæˆæœºå™¨å¯è¯»çš„è¯¦ç»†æ•°æ®

## ğŸ¯ è¦†ç›–ç‡é˜ˆå€¼

é¡¹ç›®è®¾ç½®äº†ä»¥ä¸‹è¦†ç›–ç‡é˜ˆå€¼è¦æ±‚ï¼š

- **è¯­å¥è¦†ç›–ç‡ (Statements)**: â‰¥ 80%
- **åˆ†æ”¯è¦†ç›–ç‡ (Branches)**: â‰¥ 80%
- **å‡½æ•°è¦†ç›–ç‡ (Functions)**: â‰¥ 80%
- **è¡Œè¦†ç›–ç‡ (Lines)**: â‰¥ 80%

å¦‚æœè¦†ç›–ç‡ä½äºé˜ˆå€¼ï¼Œæµ‹è¯•å°†ä¼šå¤±è´¥ã€‚

## ğŸ“‹ æŸ¥çœ‹è¯¦ç»†æŠ¥å‘Š

### HTMLæŠ¥å‘Šï¼ˆæ¨èï¼‰
```bash
# æ‰“å¼€HTMLæŠ¥å‘Šï¼ˆmacOSï¼‰
open coverage/index.html

# æˆ–åœ¨æµè§ˆå™¨ä¸­æ‰‹åŠ¨æ‰“å¼€
# file:///path/to/project/coverage/index.html
```

### æ§åˆ¶å°æ‘˜è¦
è¦†ç›–ç‡å‘½ä»¤ä¼šåœ¨æ§åˆ¶å°æ˜¾ç¤ºç±»ä¼¼ä»¥ä¸‹çš„æ‘˜è¦ï¼š
```
-----------------------------|---------|----------|---------|---------|-------------------
File                         | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s
-----------------------------|---------|----------|---------|---------|-------------------
All files                    |   85.42 |    78.91 |   90.12 |   84.56 |
 scripts                     |   75.23 |    65.45 |   85.71 |   74.12 |
  analyze-api.ts             |   75.23 |    65.45 |   85.71 |   74.12 | 120-130,150-160
 services                    |   91.84 |    86.75 |   94.44 |   91.23 |
  config-manager.ts          |   95.00 |    92.31 |   88.88 |   95.00 | 101-105
  risk-manager.ts            |   89.65 |    85.00 |   87.50 |   89.65 | 114,128
  trading-executor.ts        |   82.14 |    78.94 |   75.00 |   82.14 | 56-78
-----------------------------|---------|----------|---------|---------|-------------------
```

## âš™ï¸ é…ç½®è¯´æ˜

æµ‹è¯•è¦†ç›–ç‡åœ¨ `jest.config.js` ä¸­é…ç½®ï¼š

```javascript
module.exports = {
  // ... å…¶ä»–é…ç½®
  collectCoverageFrom: [
    'src/**/*.ts',           // æ”¶é›†æ‰€æœ‰TypeScriptæ–‡ä»¶çš„è¦†ç›–ç‡
    '!src/**/*.d.ts',        // æ’é™¤ç±»å‹å£°æ˜æ–‡ä»¶
    '!src/**/__tests__/**',  // æ’é™¤æµ‹è¯•æ–‡ä»¶
    '!src/index.ts',         // æ’é™¤å…¥å£æ–‡ä»¶
  ],
  coverageReporters: [
    'text',      // æ§åˆ¶å°è¾“å‡º
    'lcov',      // LCOVæ ¼å¼ï¼ˆç”¨äºCI/CDï¼‰
    'html',      // HTMLå¯è§†åŒ–æŠ¥å‘Š
    'json'       // JSONæ•°æ®
  ],
  coverageThreshold: {        // è¦†ç›–ç‡é˜ˆå€¼
    global: {
      branches: 80,
      functions: 80,
      lines: 80,
      statements: 80
    }
  }
};
```

## ğŸ”§ CI/CD é›†æˆ

### GitHub Actions ç¤ºä¾‹
```yaml
- name: Run tests with coverage
  run: npm run test:coverage

- name: Upload coverage to Codecov
  uses: codecov/codecov-action@v1
  with:
    file: ./coverage/lcov.info
```

## ğŸ“ æé«˜è¦†ç›–ç‡çš„å»ºè®®

1. **è¯†åˆ«æœªè¦†ç›–çš„ä»£ç **ï¼šæŸ¥çœ‹HTMLæŠ¥å‘Šä¸­çš„çº¢è‰²è¡Œå·
2. **è¡¥å……æµ‹è¯•ç”¨ä¾‹**ï¼šä¸ºæœªè¦†ç›–çš„åˆ†æ”¯å’Œæ¡ä»¶ç¼–å†™æµ‹è¯•
3. **è¾¹ç•Œæµ‹è¯•**ï¼šæµ‹è¯•å„ç§è¾¹ç•Œæ¡ä»¶å’Œå¼‚å¸¸æƒ…å†µ
4. **é›†æˆæµ‹è¯•**ï¼šç¡®ä¿ä¸åŒæ¨¡å—é—´çš„äº¤äº’ä¹Ÿè¢«æµ‹è¯•è¦†ç›–

## ğŸš¨ å¿½ç•¥ç‰¹å®šæ–‡ä»¶

å¦‚æœéœ€è¦å¿½ç•¥æŸäº›æ–‡ä»¶ä¸è®¡ç®—è¦†ç›–ç‡ï¼Œå¯ä»¥åœ¨ `jest.config.js` çš„ `collectCoverageFrom` æ•°ç»„ä¸­æ·»åŠ ï¼š

```javascript
collectCoverageFrom: [
  'src/**/*.ts',
  '!src/**/*.d.ts',
  '!src/**/__tests__/**',
  '!src/index.ts',
  '!src/utils/temp.ts',      // æ–°å¢å¿½ç•¥æ–‡ä»¶
  '!src/mocks/**'           // æ–°å¢å¿½ç•¥ç›®å½•
],
```

---

**æ³¨æ„**ï¼šä¿æŒé«˜è¦†ç›–ç‡æ˜¯å¥½çš„å®è·µï¼Œä½†ä¸è¦ä¸ºäº†è¿½æ±‚100%è¦†ç›–ç‡è€Œç¼–å†™æ— æ„ä¹‰çš„æµ‹è¯•ã€‚é‡ç‚¹åº”è¯¥æ˜¯æµ‹è¯•æœ‰ä¸šåŠ¡é€»è¾‘å’Œå¤æ‚æ¡ä»¶çš„ä»£ç ã€‚